The most effective thing we can do to reduce file inclusion vulnerabilities is to avoid passing any user-controlled inputs into any file inclusion functions or APIs. Additionally, whenever [any of these functions](obsidian://open?vault=security-notes&file=Offensive%20Security%2FWeb%20Application%20Security%2FServer-side%20Vulnerabilities%2FFile%20Inclusion%20Vulnerabilities%2FRead%20vs%20Execute) is used, we should ensure that no user input is directly going into them. Of course, this list of functions is not comprehensive, so we should generally consider any function that can read files.

In some cases, this is not feasible, instead we should utilize a limited whitelist of allowed user inputs, and match each input to the file to be loaded, while having a default value for all inputs.
## Web Server Configuration
Several configurations may also be utilized to reduce the impact of file inclusion vulnerabilities in case they occur. In PHP this can be done by setting `allow_url_fopen` and `allow_url_include` to Off.

It's also often possible to lock web applications to their web root directory, preventing them from accessing non-web related files. The most common way to do this in today's age is by running the application within `Docker`. Otherwise, you may use your programming language or frameworks built-in mechanism to prevent accessing files outside of the web directory. In PHP, that can be done by adding `open_basedir = /var/www/html` in the `php.ini` file.

Furthermore, you should ensure that certain potentially dangerous modules are disabled, like [PHP Expect](https://www.php.net/manual/en/wrappers.expect.php) [mod_userdir](https://httpd.apache.org/docs/2.4/mod/mod_userdir.html).
## Web Application Firewall
The universal way to harden applications is to utilize a Web Application Firewall (WAF), such as [ModSecurity](https://github.com/owasp-modsecurity/ModSecurity). When dealing with WAFs, the most important thing to avoid is false positives and blocking non-malicious requests. ModSecurity minimizes false positives by offering a `permissive` mode, which will only report things it would have blocked.